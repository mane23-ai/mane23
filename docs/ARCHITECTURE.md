# 시스템 아키텍처

## 전체 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                        Frontend                                  │
│  Next.js 15 (App Router) + TypeScript + Tailwind CSS + shadcn/ui│
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      API Layer                                   │
│  Next.js API Routes + Server Actions + WebSocket Server          │
└─────────────────────────────────────────────────────────────────┘
                              │
          ┌───────────────────┼───────────────────┐
          ▼                   ▼                   ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│   Supabase      │  │  Claude Code    │  │   External      │
│  - PostgreSQL   │  │  CLI Runner     │  │   APIs          │
│  - Auth         │  │  (WebSocket)    │  │  - GitHub       │
│  - Realtime     │  │                 │  │  - SNS APIs     │
│  - Storage      │  │                 │  │  - AI APIs      │
└─────────────────┘  └─────────────────┘  └─────────────────┘
```

## 핵심 모듈

### 1. 인증 시스템 (Auth)

```
┌─────────────────────────────────────────┐
│              Supabase Auth              │
│  ┌─────────────┐  ┌─────────────────┐   │
│  │ Email/Pass  │  │ GitHub OAuth    │   │
│  └─────────────┘  └─────────────────┘   │
└─────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────┐
│           Next.js Middleware            │
│  - 세션 검증                             │
│  - 라우트 보호                           │
│  - 토큰 갱신                             │
└─────────────────────────────────────────┘
```

### 2. 바이브 코딩 엔진

```
┌──────────────────────────────────────────────────────────────────┐
│                      Browser (Dashboard)                          │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │  Vibe Coding Panel                                           │ │
│  │  - 자연어 입력 폼                                             │ │
│  │  - 실시간 실행 로그 터미널                                    │ │
│  │  - 코드 변경 미리보기                                         │ │
│  │  - 작업 히스토리                                              │ │
│  └─────────────────────────────────────────────────────────────┘ │
└────────────────────────────┬─────────────────────────────────────┘
                             │ WebSocket (실시간 양방향 통신)
                             ▼
┌──────────────────────────────────────────────────────────────────┐
│                    WebSocket Server (Next.js)                     │
│  - 연결 관리 (Connection Pool)                                    │
│  - 세션 인증 (JWT 검증)                                           │
│  - 메시지 라우팅                                                  │
│  - 재연결 처리                                                    │
└────────────────────────────┬─────────────────────────────────────┘
                             │
                             ▼
┌──────────────────────────────────────────────────────────────────┐
│                    Vibe Coding Engine                             │
│                                                                   │
│  ┌────────────────┐                                              │
│  │ Command Parser │  자연어 입력 분석                             │
│  │ (자연어 분석)   │  - 의도 파악                                 │
│  │                │  - 엔티티 추출                                │
│  └───────┬────────┘                                              │
│          │                                                        │
│          ▼                                                        │
│  ┌────────────────┐                                              │
│  │ AI Interpreter │  작업 분해                                    │
│  │ (작업 분해)     │  - 단계별 명령 생성                          │
│  │                │  - 컨텍스트 유지                              │
│  └───────┬────────┘                                              │
│          │                                                        │
│          ▼                                                        │
│  ┌────────────────┐                                              │
│  │ CLI Executor   │  명령 실행                                    │
│  │ (명령 실행)     │  - 프로세스 관리                             │
│  │                │  - 출력 스트리밍                              │
│  └───────┬────────┘                                              │
│          │                                                        │
│          ▼                                                        │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │              Claude Code CLI Process                        │  │
│  │  - 프로젝트별 독립 프로세스                                  │  │
│  │  - stdout/stderr 실시간 스트리밍                            │  │
│  │  - 코드 변경 감지 및 보고                                    │  │
│  └────────────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────────────┘
```

### 3. AI 검증 파이프라인

```
콘텐츠 생성
     │
     ▼
┌─────────────────────────────────────┐
│  1차 검증 (자동)                     │
│  - 형식 검증 (마크다운, 길이 등)     │
│  - 출처 확인                         │
│  - 기본 사실 체크                    │
│  - 유해 콘텐츠 필터링                │
└─────────────────┬───────────────────┘
                  │ Pass
                  ▼
┌─────────────────────────────────────┐
│  블루팀 검증 (긍정적 관점)           │
│  - 논리적 일관성 검토                │
│  - 사실 정확도 검증                  │
│  - 윤리적 적합성 평가                │
│  - 심리학 원칙 준수 확인             │
│  - 개선 제안 생성                    │
└─────────────────┬───────────────────┘
                  │
                  ▼
┌─────────────────────────────────────┐
│  레드팀 리스크 평가 (비판적 관점)    │
│  - 오해 가능성 탐지                  │
│  - 과도한 설득 패턴 분석             │
│  - 심리 조작 요소 탐지               │
│  - 법적/윤리적 리스크 평가           │
│  - 리스크 점수 산정                  │
└─────────────────┬───────────────────┘
                  │
                  ▼
┌─────────────────────────────────────┐
│  배포 판정                           │
│                                      │
│  리스크 점수 < 0.3                   │
│  └→ 자동 배포 가능                   │
│                                      │
│  리스크 점수 0.3 ~ 0.7               │
│  └→ 경고와 함께 사용자 검토 요청     │
│                                      │
│  리스크 점수 > 0.7                   │
│  └→ 배포 차단, 수정 필요             │
└─────────────────────────────────────┘
```

### 4. 마케팅 채널 시스템

```
┌─────────────────────────────────────────────────────────────────┐
│                    Channel Plugin System                         │
│                                                                  │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                  Channel Interface                         │  │
│  │  - publish(content): Promise<ExternalPostId>              │  │
│  │  - getMetrics(postId): Promise<Metrics>                   │  │
│  │  - validate(content): ValidationResult                    │  │
│  │  - transform(content): ChannelSpecificContent             │  │
│  └───────────────────────────────────────────────────────────┘  │
│                              │                                   │
│        ┌─────────────────────┼─────────────────────┐            │
│        ▼                     ▼                     ▼            │
│  ┌───────────┐        ┌───────────┐        ┌───────────┐       │
│  │  Blog     │        │  YouTube  │        │ Instagram │       │
│  │ (티스토리) │        │           │        │           │       │
│  │ (네이버)  │        │           │        │           │       │
│  └───────────┘        └───────────┘        └───────────┘       │
│                                                                  │
│        ┌─────────────────────┐                                  │
│        ▼                                                        │
│  ┌───────────┐                                                  │
│  │  X        │                                                  │
│  │ (Twitter) │                                                  │
│  └───────────┘                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 데이터 흐름

### 프로젝트 생성 → 바이브 코딩 흐름

```
1. 의뢰 접수 (이메일/디스코드/카카오톡)
   │
   ▼
2. 프로젝트 생성
   - 의뢰인 정보 저장
   - GitHub 레포 생성/연결
   │
   ▼
3. 바이브 코딩 세션 시작
   - WebSocket 연결
   - 프로젝트 컨텍스트 로드
   │
   ▼
4. 자연어 명령 입력
   "이 프로젝트에 로그인 기능 추가해줘"
   │
   ▼
5. AI 해석 및 작업 분해
   - 로그인 폼 컴포넌트 생성
   - API 라우트 생성
   - Supabase Auth 연동
   │
   ▼
6. Claude Code CLI 실행
   - 각 단계별 명령 실행
   - 실시간 로그 스트리밍
   │
   ▼
7. 결과 저장
   - 코드 변경 내역 기록
   - 히스토리 저장
   - GitHub 커밋
```

### 콘텐츠 생성 → 배포 흐름

```
1. 콘텐츠 주제 선택/생성
   │
   ▼
2. 콘텐츠 작성 (수동 또는 AI 지원)
   │
   ▼
3. AI 검증 파이프라인
   - 1차 형식 검증
   - 블루팀 검증
   - 레드팀 리스크 평가
   │
   ▼
4. 배포 판정
   │
   ├─ 자동 배포 가능 ──→ 5a. 채널별 변환 → 배포
   │
   └─ 사용자 검토 필요 ─→ 5b. 수정 → 재검증
```

## 보안 고려사항

### 인증 및 권한

- Supabase RLS (Row Level Security) 적용
- JWT 기반 세션 관리
- API 키 암호화 저장

### 데이터 보호

- 민감 정보 암호화 (API 키, 인증 정보)
- HTTPS 필수
- CORS 정책 적용

### AI 안전성

- 레드팀 검증으로 유해 콘텐츠 필터링
- 심리 조작 패턴 탐지
- 모든 AI 판단 로그 저장
